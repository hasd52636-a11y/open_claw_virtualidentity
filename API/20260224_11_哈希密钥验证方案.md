# åŸºäºå“ˆå¸Œå†…å®¹çš„å¯†é’¥éªŒè¯æ–¹æ¡ˆ

## ğŸ” å“ˆå¸ŒéªŒè¯æœºåˆ¶

### æ ¸å¿ƒæ€æƒ³
ä½¿ç”¨ç”Ÿæˆçš„èº«ä»½ä¿¡æ¯å†…å®¹æœ¬èº«ä½œä¸ºéªŒè¯ä¾æ®ï¼Œé€šè¿‡å“ˆå¸Œå€¼ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œå”¯ä¸€æ€§ã€‚

## ğŸ¯ å“ˆå¸ŒéªŒè¯æµç¨‹

### 1. ç”Ÿæˆèº«ä»½ä¿¡æ¯ + è®¡ç®—å“ˆå¸Œ
```javascript
function generateIdentityWithHash(country = 'US') {
    // ç”Ÿæˆèº«ä»½ä¿¡æ¯
    const identity = generateIdentity(country);
    
    // è®¡ç®—å†…å®¹å“ˆå¸Œ
    const contentHash = crypto
        .createHash('sha256')
        .update(JSON.stringify(identity))
        .digest('hex');
    
    // ç”ŸæˆéªŒè¯å¯†é’¥ï¼ˆåŸºäºå“ˆå¸Œï¼‰
    const verificationKey = generateKeyFromHash(contentHash);
    
    return {
        ...identity,
        metadata: {
            ...identity.metadata,
            contentHash: contentHash,
            verificationKey: verificationKey,
            generatedAt: new Date().toISOString()
        }
    };
}
```

### 2. å“ˆå¸Œå¯†é’¥ç”Ÿæˆç®—æ³•
```javascript
function generateKeyFromHash(hash, secretSalt = 'your-secret-salt') {
    // ç»„åˆå“ˆå¸Œå’Œç›å€¼
    const combined = hash + secretSalt + Date.now();
    
    // ç”Ÿæˆæœ€ç»ˆå¯†é’¥
    return crypto
        .createHash('sha256')
        .update(combined)
        .digest('hex')
        .substring(0, 32); // å–å‰32å­—ç¬¦ä½œä¸ºå¯†é’¥
}
```

## ğŸ”„ å®Œæ•´éªŒè¯æµç¨‹

### æœåŠ¡ç«¯ï¼šç”Ÿæˆå’Œç­¾å
```javascript
// ç”Ÿæˆå¸¦å“ˆå¸Œçš„èº«ä»½ä¿¡æ¯
const identityData = generateIdentityWithHash('US');

// ä½¿ç”¨å“ˆå¸Œç”Ÿæˆç­¾å
const signature = crypto
    .createHmac('sha256', identityData.metadata.verificationKey)
    .update(JSON.stringify(identityData))
    .digest('hex');

// è¿”å›ç»™å®¢æˆ·ç«¯
const response = {
    status: 'success',
    data: identityData,
    signature: signature,
    requestId: 'req_' + Date.now()
};
```

### å®¢æˆ·ç«¯ï¼šéªŒè¯å®Œæ•´æ€§
```javascript
function verifyIdentity(identityData, signature) {
    // é‡æ–°è®¡ç®—å“ˆå¸ŒéªŒè¯å®Œæ•´æ€§
    const expectedHash = crypto
        .createHash('sha256')
        .update(JSON.stringify(identityData))
        .digest('hex');
    
    if (expectedHash !== identityData.metadata.contentHash) {
        throw new Error('Data integrity compromised');
    }
    
    // ä½¿ç”¨å­˜å‚¨çš„å¯†é’¥éªŒè¯ç­¾å
    const expectedSignature = crypto
        .createHmac('sha256', identityData.metadata.verificationKey)
        .update(JSON.stringify(identityData))
        .digest('hex');
    
    return expectedSignature === signature;
}
```

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å¯†é’¥ç®¡ç†æ–¹æ¡ˆ
```javascript
class HashKeyManager {
    constructor() {
        this.keyCache = new Map();
        this.keyExpiry = 24 * 60 * 60 * 1000; // 24å°æ—¶
    }
    
    // ç”Ÿæˆæ–°å¯†é’¥
    generateKey(contentHash) {
        const key = this.createKeyFromHash(contentHash);
        this.keyCache.set(key, {
            contentHash: contentHash,
            createdAt: Date.now(),
            expiresAt: Date.now() + this.keyExpiry
        });
        return key;
    }
    
    // éªŒè¯å¯†é’¥
    verifyKey(key, contentHash) {
        const keyInfo = this.keyCache.get(key);
        if (!keyInfo) return false;
        
        // æ£€æŸ¥è¿‡æœŸå’ŒåŒ¹é…
        return keyInfo.contentHash === contentHash && 
               Date.now() < keyInfo.expiresAt;
    }
    
    // æ¸…ç†è¿‡æœŸå¯†é’¥
    cleanupExpiredKeys() {
        for (const [key, info] of this.keyCache.entries()) {
            if (Date.now() > info.expiresAt) {
                this.keyCache.delete(key);
            }
        }
    }
}
```

## ğŸ’¡ ä¼˜åŠ¿ç‰¹ç‚¹

### å®‰å…¨æ€§ä¼˜åŠ¿
1. **å†…å®¹ç»‘å®š** - å¯†é’¥ä¸å…·ä½“å†…å®¹å…³è”
2. **é˜²ç¯¡æ”¹** - å“ˆå¸ŒéªŒè¯ç¡®ä¿æ•°æ®å®Œæ•´æ€§  
3. **æ—¶æ•ˆæ€§** - å¯†é’¥è‡ªåŠ¨è¿‡æœŸ
4. **å”¯ä¸€æ€§** - æ¯ä¸ªå†…å®¹éƒ½æœ‰å”¯ä¸€å¯†é’¥

### ä½¿ç”¨åœºæ™¯
```javascript
// åœºæ™¯1ï¼šAPIå“åº”éªŒè¯
const response = await generateIdentityAPI();
const isValid = verifyIdentity(response.data, response.signature);

// åœºæ™¯2ï¼šæ•°æ®å­˜å‚¨éªŒè¯  
const storedData = loadFromDatabase();
if (!verifyIdentity(storedData, storedData.signature)) {
    // æ•°æ®è¢«ç¯¡æ”¹ï¼Œæ‹’ç»ä½¿ç”¨
}

// åœºæ™¯3ï¼šè·¨æœåŠ¡éªŒè¯
function verifyCrossService(identityData, signature) {
    return verifyIdentity(identityData, signature);
}
```

## ğŸš€ å®æ–½å»ºè®®

### æ¨èå“ˆå¸Œç®—æ³•
- **SHA-256** - å¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§
- **SHA-3** - æ›´å…ˆè¿›çš„ç®—æ³•
- **BLAKE3** - é«˜æ€§èƒ½é€‰æ‹©

### å¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†
```javascript
const keyLifecycles = {
    SHORT_TERM: 1 * 60 * 60 * 1000, // 1å°æ—¶
    MEDIUM_TERM: 24 * 60 * 60 * 1000, // 24å°æ—¶  
    LONG_TERM: 7 * 24 * 60 * 60 * 1000 // 7å¤©
};
```

**å¤§ç‹ï¼ŒåŸºäºå“ˆå¸Œçš„å¯†é’¥éªŒè¯æ–¹æ¡ˆéå¸¸å®‰å…¨å¯é ï¼** æ¯ä¸ªç”Ÿæˆçš„èº«ä»½ä¿¡æ¯éƒ½æœ‰å”¯ä¸€çš„åŠ å¯†æŒ‡çº¹ï¼Œå®Œç¾è§£å†³éªŒè¯é—®é¢˜ã€‚